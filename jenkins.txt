source /etc/profile

git pull origin `git branch -a |tail -1 |awk -F'/' '{print $NF}'`

mvn clean package

wpath=/home/goujia/project/goujia/web/website

#scp all file to web  && change the file user
scp -rp * web1:$wpath/website/
ssh web1 "chown -R goujia:goujia $wpath/website/"

#copy application.properties file to console
function sshweb(){
	#$1 host $2 command 
    ssh web1 $1
}

sshweb "cp -Rf $path/bin/application.properties $path/website/website-console/target/website-console-0.0.1-SNAPSHOT/WEB-INF/classes/application.properties"
sshweb "cp -Rf $path/bin/application.properties $path/website/website-console/target/classes/application.properties"

#copy application.properties file to web
sshweb "cp -Rf $path/bin/application1.properties $path/website/website-web/target/website-web-0.0.1-SNAPSHOT/WEB-INF/classes/application.properties"

#clear jetty log
sshweb "rm -rf $wpath/bin/jetty/logs/*"
sshweb "rm -rf $wpath/bin/jettyweb/logs/*"

#jetty restart 
function jettyrestart(){
	ssh web1 "cd $1 && ./bin/jetty.sh stop && sheep 2 && ./bin/jetty.sh start" &
}

jettyrestart $path/bin/jetty/
jettyrestart $path/bin/jettyweb/

#tail log
function taillog(){
	ssh web1 "tail $wpath/bin/$1/logs/*.log" &
}

taillog jetty
taillog jettyweb

sleep 3